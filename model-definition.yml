kind: Model
api_version: v1beta1
metadata:
  display_name: CityCAT (OpenCLIM)
  name: citycat-openclim
  publisher: Newcastle University
  summary: CityCAT is a tool for modelling, analysis and visualisation of surface water flooding.
  source_code: https://github.com/OpenCLIM/citycat-dafni
  description: >
    CityCAT (City Catchment Analysis Tool) is a unique software tool for modelling, analysis and visualisation of
    surface water flooding. CityCAT enables rapid assessment of combined pluvial and fluvial flood risk and allows
    assessment of the effects of different flood alleviation measures.

    When used in return period mode, rainfall events are extracted from the UKCP19 baseline period 1980-2000.
spec:
  inputs:
    parameters:
      - name: RAINFALL_MODE
        title: Rainfall mode
        type: string
        description: Generate events using return period or total depth
        default: return_period
        required: true
        options:
          - name: return_period
            title: Return Periods
          - name: total_depth
            title: Total depth

      - name: RETURN_PERIOD
        title: Return Period (years)
        description: The return period of the rainfall event
        type: string
        default: '100'
        required: false
        options:
          - name: '2'
            title: '2'
          - name: '5'
            title: '5'
          - name: '10'
            title: '10'
          - name: '25'
            title: '25'
          - name: '30'
            title: '30'
          - name: '100'
            title: '100'

      - name: TOTAL_DEPTH
        title: Total depth (mm)
        description: The total depth of rainfall during the event
        type: number
        default: 40
        required: false
        min: 10
        max: 100

      - name: DURATION
        title: Duration (hours)
        description: The duration of the rainfall event
        type: string
        default: '1'
        required: true
        options:
          - name: '1'
            title: '1'
          - name: '3'
            title: '3'
          - name: '6'
            title: '6'
          - name: '12'
            title: '12'
          - name: '24'
            title: '24'

      - name: POST_EVENT_DURATION
        title: Post-event Duration (hours)
        description: The duration of the dry period following the rainfall event
        type: number
        required: true
        default: 0
        min: 0
        max: 10

      - name: SIZE
        title: Domain Size (km)
        description: The width and height of the domain to create
        type: number
        default: 6
        required: true
        min: 0.1
        max: 10000

      - name: X
        title: Domain Centroid X (OSGB)
        description: The X coordinate of the domain centroid in OSGB
        type: integer
        default: 258722
        required: true

      - name: Y
        title: Domain Centroid Y (OSGB)
        description: The Y coordinate of the domain centroid in OSGB
        type: integer
        default: 665028
        required: true

      - name: OPEN_BOUNDARIES
        title: Open Boundaries
        description: Whether to set boundaries as open
        type: boolean
        default: True
        required: true

      - name: PERMEABLE_AREAS
        title: Permeable areas
        type: string
        description: Use green areas polygons or assume everywhere is permeable or impermeable
        default: polygons
        required: true
        options:
          - name: polygons
            title: Polygons
          - name: permeable
            title: Permeable
          - name: impermeable
            title: Impermeable

      - name: ROOF_STORAGE
        title: Roof storage
        description: Depth of water that can be stored on rooftops (m)
        type: number
        default: 0
        required: true
        min: 0
        max: 10

      - name: TIME_HORIZON
        title: Time horizon
        description: The time horizon to use when selecting rainfall uplifts, baseline indicates no uplift
        type: string
        default: '2070'
        required: false
        options:
          - name: '2070'
            title: '2070'
          - name: '2050'
            title: '2050'
          - name: baseline
            title: baseline

      - name: DISCHARGE
        title: Discharge (m3/s)
        description: Value of discharge boundary condition, if provided then the flow polygons dataslot is required
        type: number
        default: 0
        required: true
        min: 0
        max: 1000


    dataslots:
      - name: Digital Elevation Model
        description: Digital Elevation Model
        default:
          - 859e810c-4597-44b6-8d92-a9f00e45dcbd
        path: inputs/dem
        required: true

      - name: Boundary
        description: Boundary used to clip DEM
        default:
          - 859e810c-4597-44b6-8d92-a9f00e45dcbd
        path: inputs/dem
        required: false

      - name: Future Drainage
        description: Set of CSV files containing gridded uplifts based on UKCP18 from the FUTURE-DRAINAGE project
        path: inputs/boundary
        required: false

      - name: Buildings
        description: Buildings
        default:
          - 7f0344d8-079c-41ce-828e-9caadc431628
        path: inputs/buildings
        required: false

      - name: Green areas
        description: Green areas
        default:
          - 22601187-67c5-4cbd-927f-0d5d38fe9dbe
        path: inputs/green_areas
        required: false

      - name: Flow Polygons
        description: Polygons used to define where discharge will enter the domain
        path: inputs/flow_polygons
        required: false

  outputs:
    datasets:
      - name: outputs/run/**/*
        type: folder
        description: path to model outputs

      - name: outputs/metadata.json
        type: JSON
        description: NID metadata for outputs
